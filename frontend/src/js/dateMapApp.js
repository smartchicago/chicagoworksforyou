window.convertPoint = function (pt) {
    var minlat = 41.644553;
    var minlng = -87.525162;

    return [
        (pt[0] / 1000000) + minlat,
        (pt[1] / -1000000) + minlng
    ];
};

window.simpleWardPaths = [[[294932,160461],[293113,160417],[291319,157947],[291377,153075],[283532,152938],[283911,154543],[280416,157576],[280348,162480],[273015,162248],[269029,157258],[258554,156978],[258508,159418],[255778,159348],[255740,161798],[251190,161681],[250365,156763],[251274,156787],[251379,150670],[253199,150722],[253234,148278],[255061,148327],[254998,151994],[257703,152068],[257664,154512],[265887,154745],[266044,144972],[269739,145069],[269745,142071],[259170,137459],[258806,141322],[257035,138570],[256971,142282],[254245,142205],[254287,139758],[251558,139743],[251521,142130],[247874,142023],[246995,151767],[248620,151812],[248467,161601],[249375,161626],[249357,164081],[251163,164145],[251149,166611],[252960,166656],[252982,164189],[254801,164234],[254730,171629],[257441,171694],[256623,164282],[258214,161858],[262114,161961],[263914,164468],[265741,164505],[265645,173918],[269388,174031],[269451,171935],[282077,172302],[282163,162547],[283233,162581],[288786,172486],[294840,172661],[294907,162749],[295813,162777],[295842,160485],[294932,160461]],[[239222,171197],[240429,151577],[235460,151450],[236986,136810],[233157,136724],[233239,131858],[237063,131980],[237185,124535],[232102,123206],[232139,120541],[237241,120836],[237267,118965],[235982,118501],[237307,116031],[237393,108662],[233566,108567],[233779,95515],[228660,95431],[228744,91066],[224346,91050],[223755,87611],[222200,87526],[222685,81514],[221871,80449],[219721,82417],[217452,80859],[215527,80803],[215405,81910],[208806,81349],[209217,84735],[221312,85318],[221290,87507],[218818,88278],[215793,86988],[212409,87878],[206509,84110],[200943,83452],[201132,95319],[197468,95221],[197515,92414],[182902,93175],[182875,95309],[190167,95459],[190188,94249],[193828,95474],[193756,100889],[209702,101176],[209731,98689],[213325,98771],[213302,100449],[217878,100555],[217357,105091],[215568,105102],[215401,119306],[222631,119605],[222601,121756],[229786,121965],[229647,141437],[227075,141369],[227109,138988],[224748,138914],[224811,134949],[226682,134970],[226759,131653],[222444,131519],[222524,126655],[218917,126678],[218869,131254],[215164,134409],[214878,153413],[218406,153447],[218849,158342],[222094,158428],[222129,155980],[224229,156018],[226900,152815],[226925,151222],[229490,151294],[229374,158619],[226812,158558],[225676,163409],[226584,163432],[226559,165992],[233843,166292],[233817,168623],[231455,168552],[231428,170991],[229361,170944],[229263,168516],[226533,168416],[225573,173288],[226483,173312],[226455,175762],[232824,175946],[232856,173471],[233707,173482],[233731,175969],[236473,176046],[236448,178499],[240876,178626],[240958,171244],[239222,171197]],[[217350,100541],[209731,98689],[209702,101176],[193756,100889],[193828,95474],[190188,94249],[190167,95459],[182875,95309],[182921,91910],[179281,91835],[179338,87462],[172130,88928],[172153,87696],[170337,87635],[170414,83157],[168596,83116],[168570,84750],[166753,84705],[166727,86337],[161250,87425],[161189,91334],[159369,91290],[159430,87384],[157598,87341],[157550,90949],[149369,90796],[149747,100529],[145440,100419],[146241,112602],[142598,112501],[142514,117372],[147908,117518],[147931,119951],[153289,120086],[153256,122533],[159726,122685],[159703,125112],[162419,125181],[162294,134896],[164116,134944],[164029,142233],[167664,142348],[167817,130084],[164181,130078],[164311,120376],[160665,120279],[160834,115467],[164399,115517],[164494,110612],[179032,111003],[179063,108601],[182712,108680],[182728,107465],[186375,106674],[186418,104399],[217357,105091],[217350,100541]],[[201102,92048],[200607,83719],[194959,81933],[194082,80994],[195276,79023],[193998,80973],[189243,79706],[181791,72593],[177412,71678],[173790,67454],[168963,64874],[167301,62187],[162662,59996],[159283,54884],[155125,55132],[155011,62140],[150632,62387],[150648,64048],[152046,63866],[150571,67146],[150807,74486],[154870,74578],[154851,76144],[151932,76076],[151914,77599],[155917,78778],[155881,81191],[150412,81053],[150418,82221],[154071,82752],[153956,88767],[150270,89543],[150248,90819],[157550,90949],[157598,87341],[159430,87384],[159369,91290],[161189,91334],[161250,87425],[166727,86337],[166753,84705],[170414,83157],[170337,87635],[172153,87696],[172195,88933],[179338,87462],[179281,91835],[182921,91910],[182902,93175],[197515,92414],[197468,95221],[201132,95319],[201102,92048]],[[153602,78731],[151914,77599],[151932,76076],[154851,76144],[154870,74578],[150807,74486],[150498,72936],[150571,67146],[152041,64469],[150648,64048],[150632,62387],[155011,62140],[155125,55132],[152499,53131],[152316,50459],[150916,50245],[149860,53607],[147483,54466],[144017,51158],[143745,52597],[139098,50938],[136744,44521],[137055,43235],[140044,42370],[136986,43144],[134558,49573],[131232,49881],[131325,46774],[133753,48199],[134675,47076],[127473,38419],[124448,37176],[123844,35365],[124626,34374],[122013,34401],[121765,41322],[118053,42503],[118014,46140],[114381,46084],[114323,50980],[116144,51020],[116095,55309],[119736,55392],[119704,58464],[121450,58513],[121439,59611],[117873,59522],[117857,61070],[106953,60662],[106917,62865],[121281,82812],[121316,80425],[130407,80647],[130598,63678],[134219,63770],[134216,61258],[136066,61296],[136029,64560],[141569,63920],[141321,80875],[155881,81191],[155917,78778],[153602,78731]],[[128223,101603],[128171,99966],[124641,99780],[124827,88565],[126050,87021],[124853,85355],[128525,84248],[128566,81861],[126747,81821],[126769,80565],[121316,80425],[121281,82812],[117704,77830],[117696,78764],[106762,77595],[106563,80075],[82981,79444],[82898,84283],[81095,84203],[83533,89144],[77339,88981],[77060,80994],[76063,79523],[70496,80736],[69386,82533],[68937,93117],[71184,97721],[99102,99170],[99082,100467],[109999,101951],[109955,104380],[119059,104566],[118811,120416],[127902,120651],[127919,119435],[129742,119482],[130010,102697],[128223,101603]],[[100173,20792],[100153,22745],[96527,23577],[94728,20198],[89247,20587],[89211,21796],[89210,23428],[92879,22546],[92860,23691],[97530,26356],[101938,25208],[100087,27599],[100039,31247],[98220,31214],[98237,30004],[94599,29946],[94584,31160],[85461,30243],[85504,27477],[83194,27420],[81836,28871],[81798,31531],[78148,31442],[78101,34738],[67218,34565],[67131,41818],[65307,41787],[65313,44804],[63475,44193],[63416,48327],[75696,59786],[77786,59965],[78681,47785],[88890,48041],[88989,40752],[99908,40963],[99893,42180],[105345,42260],[105299,45915],[112549,46071],[118014,46140],[118053,42503],[121765,41322],[121752,35212],[118257,32440],[114244,23834],[114414,21202],[115559,18691],[116093,21330],[116096,19163],[112716,15435],[110682,18799],[107667,18329],[103405,5750],[100500,5284],[100173,20792]],[[119878,58469],[119736,55392],[116095,55309],[116144,51020],[114323,50980],[114381,46084],[105299,45915],[105345,42260],[99893,42180],[99908,40963],[88989,40752],[88890,48041],[78681,47785],[77786,59965],[66697,59466],[63221,60584],[62880,81356],[77495,78020],[77491,79320],[106563,80075],[106762,77595],[117696,78764],[106917,62865],[106953,60662],[117857,61070],[117873,59522],[121439,59611],[121450,58513],[119878,58469]],[[81421,84862],[82898,84283],[82981,79444],[77491,79320],[77495,78020],[62880,81356],[63110,67325],[61948,66984],[58473,67423],[41284,76558],[30333,76117],[5967,55397],[142,53215],[31,92054],[5723,92068],[6333,95154],[14552,92548],[14509,94522],[16588,94695],[17861,96873],[17706,99261],[13280,105913],[12802,110073],[13602,110082],[13846,113696],[22369,113975],[22497,103154],[33406,103499],[33473,97496],[62612,98361],[62412,114029],[69696,114223],[70120,98248],[71184,97721],[68915,92927],[69616,81906],[76063,79523],[77060,80994],[77339,88981],[83533,89144],[81421,84862]],[[100191,20310],[100510,5280],[96913,4681],[96925,-704],[96470,14689],[96064,4691],[87824,4329],[86550,-477],[77354,-699],[74892,443],[72860,-697],[72693,1439],[70879,3538],[67811,1320],[68784,1],[66260,3242],[64782,-1029],[64996,1054],[63939,-630],[0,0],[151,53211],[5976,55393],[29585,75743],[41293,76554],[58633,67353],[63120,67321],[63231,60580],[64072,60090],[75705,59782],[63425,48323],[63485,44189],[65322,44801],[65317,41783],[67140,41814],[67228,34561],[78111,34734],[78157,31438],[81808,31527],[81846,28867],[83203,27416],[85514,27473],[85470,30239],[94593,31156],[94608,29942],[98246,30001],[98230,31210],[100049,31243],[100096,27595],[101947,25204],[97539,26352],[92870,23687],[92888,22542],[89220,23424],[89221,21792],[89256,20583],[94737,20194],[96537,23573],[100162,22741],[100191,20310]],[[203336,116644],[202709,104848],[186418,104399],[186375,106674],[182728,107465],[182712,108680],[179063,108601],[179032,111003],[164494,110612],[164399,115517],[160834,115467],[160665,120279],[164311,120376],[164181,130078],[167817,130084],[167669,139902],[178597,140300],[178447,159078],[187550,159291],[187625,152618],[195554,152863],[199430,144769],[200389,141572],[199448,138757],[203767,131511],[203394,127891],[204954,118818],[203336,116644]],[[205579,170238],[205560,167783],[203744,167731],[203815,162629],[192466,162327],[195554,152863],[187625,152618],[187550,159291],[178447,159078],[178597,140300],[167669,139902],[167621,147193],[165803,147142],[165780,149530],[160305,150648],[159974,161525],[162061,161666],[162015,165318],[163788,165384],[163707,170266],[178233,169465],[178184,171926],[180010,171942],[179958,174394],[178085,176844],[177911,189143],[184061,189254],[187087,179507],[192680,179661],[192631,182115],[196305,180987],[196324,179768],[201757,181147],[201797,178699],[203602,178756],[203635,176310],[207265,176419],[207300,173927],[211557,174075],[212239,175696],[214552,176455],[216622,170589],[205579,170238]],[[148651,197997],[147729,197970],[147804,193076],[141461,192895],[141539,187994],[112750,187180],[112599,197014],[97626,196517],[97344,215942],[130227,217003],[129459,255958],[131305,256034],[131401,251145],[133215,251219],[133309,246334],[140650,246618],[140840,236862],[133500,236553],[133876,217131],[141181,217368],[141230,212461],[148520,212677],[148651,197997]],[[177910,189100],[178085,176844],[179958,174394],[180010,171942],[178184,171926],[178233,169465],[163707,170266],[163788,165384],[162015,165318],[162061,161666],[159974,161525],[160002,159206],[149324,158880],[149096,171078],[141814,170872],[141461,192895],[147804,193076],[147874,188206],[156135,188452],[155952,201886],[163273,202094],[163131,213110],[170399,213340],[170378,218196],[172856,218263],[172408,219512],[177479,219601],[177565,213487],[176434,213458],[184061,189254],[177910,189100]],[[149020,139412],[144014,139279],[144049,136845],[142964,136815],[136775,136668],[136724,140311],[125819,138806],[125665,152031],[127479,152094],[127425,158282],[120127,159305],[120105,160526],[123722,161853],[123624,167958],[127271,168044],[126969,187609],[137904,187885],[138131,173206],[139952,173257],[140174,159365],[138358,158580],[138322,154953],[148947,153645],[149020,139412]],[[160411,139705],[158587,139663],[158617,137233],[160223,137275],[160296,127551],[158752,127513],[158785,125088],[149317,124848],[149348,122421],[146079,122331],[146114,119903],[140505,118575],[140538,117327],[138872,117307],[138913,114919],[131622,114481],[131609,115612],[135258,115709],[135178,120908],[127919,119435],[127887,121862],[131522,121960],[131421,129240],[133239,129290],[133083,140274],[136724,140311],[136775,136668],[144049,136845],[144014,139279],[149111,139413],[148947,153645],[138322,154953],[138358,158580],[140174,159365],[139952,173257],[138131,173206],[137904,187885],[141539,187994],[141814,170872],[149096,171078],[149324,158880],[160002,159206],[160411,139705]],[[131581,129244],[131522,121960],[118811,120416],[119059,104566],[109955,104380],[109999,101951],[102729,100557],[102570,110008],[104398,109531],[104124,128528],[105944,128575],[105724,144333],[113231,144530],[113101,153378],[120201,153564],[120127,159305],[127425,158282],[127479,152094],[125665,152031],[125819,138806],[133102,139009],[133239,129290],[131581,129244]],[[123678,167960],[123722,161853],[120105,160526],[120201,153564],[113101,153378],[113231,144530],[105724,144333],[105740,143129],[102099,143040],[102145,139396],[91237,137903],[89971,215905],[97344,215942],[97626,196517],[112599,197014],[112750,187180],[126969,187609],[127271,168044],[123678,167960]],[[46307,214577],[46732,195155],[68617,195963],[68744,187416],[61521,185962],[61620,176572],[62531,176040],[62650,166357],[69013,166567],[69109,156680],[90974,157352],[91104,147917],[85588,142895],[76649,138283],[66789,133810],[66769,135342],[58983,132071],[51212,134585],[40151,142560],[40126,143891],[32780,147247],[32655,161043],[39922,160560],[39780,170463],[43523,170603],[43380,174311],[39710,175391],[39634,180255],[36026,180123],[35888,186195],[39541,186345],[39079,214288],[46307,214577],[54427,166197],[54375,170859],[47162,170601],[47730,165847],[54427,166197]],[[164285,142240],[164116,134944],[162294,134896],[162419,125181],[159703,125112],[159726,122685],[153256,122533],[153289,120086],[147931,119951],[147908,117518],[142514,117372],[142598,112501],[146241,112602],[145440,100419],[149747,100529],[149369,90796],[153956,88767],[154071,82752],[150418,82221],[150412,81053],[141321,80875],[141569,63920],[136029,64560],[136066,61296],[134216,61258],[134219,63770],[130598,63678],[130407,80647],[126769,80565],[126747,81821],[128566,81861],[128525,84248],[124853,85355],[126050,87021],[124827,88565],[124624,98614],[124788,99851],[128171,99966],[128132,101601],[129986,102564],[129720,120699],[135178,120908],[135258,115709],[131609,115612],[131622,114481],[138913,114919],[138872,117307],[140538,117327],[140505,118575],[146114,119903],[146079,122331],[149348,122421],[149317,124848],[158785,125088],[158752,127513],[160296,127551],[160223,137275],[158617,137233],[158587,139663],[160411,139705],[160305,150648],[165780,149530],[165803,147142],[167621,147193],[167664,142348],[164285,142240]],[[91104,147917],[91237,137903],[98524,138090],[98503,139303],[102145,139396],[102099,143040],[105740,143129],[105944,128575],[104124,128528],[104398,109531],[102570,110008],[102729,100557],[99082,100467],[99102,99170],[70120,98248],[70702,101372],[68855,126068],[66376,127814],[55926,128010],[54963,128659],[54891,133576],[58983,132071],[66769,135342],[66789,133810],[69448,134811],[84294,142083],[91104,147917]],[[207190,185821],[207199,181310],[203571,181201],[203587,179986],[201781,179932],[201489,181142],[196324,179768],[196305,180987],[192631,182115],[192680,179661],[187087,179507],[176434,213458],[206795,214343],[207190,185821]],[[170377,218116],[170399,213340],[163131,213110],[163273,202094],[155952,201886],[156135,188452],[147874,188206],[148520,212677],[141230,212461],[141181,217368],[133876,217131],[133500,236553],[140840,236862],[140650,246618],[133309,246334],[133215,251219],[131401,251145],[131305,256034],[129459,255958],[129144,275644],[153442,276464],[154849,272025],[155634,227574],[168757,227915],[171410,219493],[172856,218263],[170377,218116]],[[232413,210187],[231504,210155],[231688,195515],[229888,195240],[230354,180789],[229135,180755],[229162,178304],[221877,178037],[221958,170745],[216622,170589],[214552,176455],[212239,175696],[211557,174075],[207300,173927],[207265,176419],[203635,176310],[203602,178756],[201797,178699],[203571,181201],[207199,181310],[206795,214343],[221406,214820],[221199,229371],[228393,229644],[228474,223983],[232178,224120],[232413,210187]],[[229786,121965],[222601,121756],[222631,119605],[215401,119306],[215568,105102],[202709,104848],[203023,115264],[204954,118818],[203394,127891],[203767,131511],[199448,138757],[200269,142341],[192466,162327],[211150,162798],[211156,160575],[226776,161007],[226812,158558],[229374,158619],[229490,151294],[226925,151222],[226900,152815],[224229,156018],[222129,155980],[222094,158428],[218849,158342],[218406,153447],[214878,153413],[215164,134409],[218869,131254],[218917,126678],[222524,126655],[222444,131519],[226759,131653],[226682,134970],[224811,134949],[224748,138914],[227109,138988],[227075,141369],[229647,141437],[229786,121965]],[[278370,186892],[278334,182348],[281815,182104],[280680,179504],[278695,179432],[278676,181660],[274672,181872],[274613,186771],[270952,188318],[271058,177222],[265620,177054],[265741,164505],[263914,164468],[262114,161961],[257534,161844],[256598,166746],[257488,166770],[257441,171694],[254730,171629],[254801,164234],[252982,164189],[252960,166656],[251149,166611],[251163,164145],[249357,164081],[249375,161626],[248467,161601],[248620,151812],[246995,151767],[248816,140416],[245352,140321],[245049,163895],[246795,164015],[251076,174749],[251026,178967],[252757,178969],[259653,196316],[267206,196336],[272645,198799],[272655,197728],[276317,197836],[276360,194168],[278190,194223],[278221,191777],[283702,191926],[283763,187040],[278370,186892]],[[261133,111969],[259256,111890],[259300,109316],[252043,109041],[251902,119060],[249586,118913],[246860,116016],[246675,119206],[237267,118965],[237241,120836],[232139,120541],[232102,123206],[237185,124535],[237063,131980],[233239,131858],[233157,136724],[236986,136810],[235460,151450],[240429,151577],[239097,171193],[240958,171244],[240876,178626],[238268,178551],[238241,181008],[245754,181236],[245702,186117],[243626,186063],[243501,195821],[240651,195758],[240914,200643],[256294,201087],[256253,203546],[261690,203699],[261726,201552],[252757,178969],[251026,178967],[251076,174749],[246795,164015],[244984,163301],[245352,140321],[251521,142130],[251558,139743],[254287,139758],[254245,142205],[256971,142282],[257035,138570],[258806,141322],[258956,132263],[256260,130219],[253410,122667],[266367,123110],[266465,118269],[261894,118136],[260649,116409],[264657,115794],[264689,113372],[266562,113430],[266608,109549],[263113,109444],[263068,112050],[261133,111969]],[[250538,200910],[240914,200643],[240651,195758],[243501,195821],[243626,186063],[245702,186117],[245754,181236],[238241,181008],[238268,178551],[236448,178499],[236473,176046],[233731,175969],[233707,173482],[232856,173471],[232824,175946],[226455,175762],[226483,173312],[225573,173288],[226533,168416],[229263,168516],[229241,170939],[231428,170991],[231455,168552],[233817,168623],[233843,166292],[226559,165992],[225696,160979],[211156,160575],[211150,162798],[203815,162629],[203744,167731],[205560,167783],[205527,170236],[221958,170745],[221877,178037],[229162,178304],[229135,180755],[230354,180789],[229888,195240],[231688,195515],[231504,210155],[232413,210187],[232178,224120],[231275,224086],[230295,229697],[235819,229905],[235715,238026],[239703,238164],[239682,239840],[244737,240019],[244367,232665],[250357,232889],[250411,225544],[244972,225091],[244993,222904],[250432,223096],[250538,200910]],[[283279,250692],[282962,248248],[279313,248124],[279254,251770],[276231,251668],[274878,244310],[275723,244343],[275861,240693],[274207,240628],[273295,235709],[270345,235593],[270440,240528],[239682,239840],[239703,238164],[235715,238026],[235819,229905],[230295,229697],[231275,224086],[228474,223983],[228393,229644],[221199,229371],[220906,248977],[264701,250437],[264595,259840],[290108,260648],[290175,255788],[292002,255849],[292070,250989],[283279,250692]],[[298276,194795],[296453,194742],[296437,195963],[292586,195478],[291460,193628],[290374,194804],[290095,192101],[288275,192051],[287285,198138],[272655,197728],[272645,198799],[267206,196336],[259653,196316],[265214,210359],[268948,208606],[268934,209838],[272505,209934],[272492,211166],[276153,211273],[276281,200656],[290878,201918],[290899,199480],[293953,197734],[297187,203022],[296303,203924],[297208,206943],[295386,206898],[295353,209437],[298083,209517],[298035,213212],[294392,213103],[294211,226628],[292388,226558],[292166,243702],[286707,242300],[286784,236173],[279492,235906],[279352,245692],[281176,245755],[281160,246971],[277511,246842],[277491,248058],[282962,248248],[282931,250679],[293895,251053],[294115,233975],[295028,234011],[295092,229110],[296004,229138],[296098,221755],[301571,221903],[301779,205468],[305440,205579],[305460,203945],[307280,203975],[303380,194967],[298276,194795]],[[295641,209445],[295386,206898],[297208,206943],[296303,203924],[297187,203022],[293953,197734],[290899,199480],[290878,201918],[276281,200656],[276153,211273],[272492,211166],[272505,209934],[268934,209838],[268948,208606],[265214,210359],[272291,228213],[275936,228420],[275905,230880],[279554,230984],[279492,235906],[286784,236173],[286707,242300],[292166,243702],[292388,226558],[294211,226628],[294392,213103],[298035,213212],[298083,209517],[295641,209445]],[[302437,143696],[298790,143601],[298773,144820],[295144,143500],[296118,139239],[295212,138659],[295285,133807],[288003,133548],[288085,128697],[283548,128541],[283459,133373],[282168,133341],[280739,133291],[280823,128451],[275370,128266],[275268,135553],[276188,138023],[272507,137892],[272405,139095],[271080,138544],[271629,136010],[270528,133987],[271968,132176],[273481,133057],[273552,128205],[269182,128050],[267052,124356],[266321,125944],[263981,125877],[264024,123049],[253410,122667],[256260,130219],[258956,132263],[258856,137466],[269745,142071],[269739,145069],[266044,144972],[265887,154745],[257664,154512],[257703,152068],[254998,151994],[255061,148327],[253234,148278],[253199,150722],[251379,150670],[250318,159209],[251232,159235],[251190,161681],[255740,161798],[255778,159348],[258508,159418],[258554,156978],[269029,157258],[273015,162248],[280348,162480],[280416,157576],[283911,154543],[283532,152938],[291377,153075],[291319,157947],[293113,160417],[295842,160485],[295813,162777],[300366,163044],[300542,148458],[302374,148560],[302437,143696]],[[311086,169254],[305273,171684],[298213,170117],[294874,167405],[294840,172661],[288786,172486],[294550,182518],[301365,182642],[303921,186385],[309322,186519],[309286,188963],[311105,189032],[311090,190256],[307348,191373],[308204,192621],[307405,192598],[307382,195047],[309201,195096],[309177,193924],[310774,196371],[311022,195154],[323769,195535],[323899,183310],[331195,183519],[331221,179563],[325865,177542],[318378,170315],[311086,169254]],[[68805,114201],[62412,114029],[62612,98361],[33473,97496],[33406,103499],[22497,103154],[22369,113975],[13846,113696],[13602,110082],[12796,110215],[13077,121826],[18606,122055],[18692,116259],[25987,116503],[25782,135988],[32991,136203],[32885,141609],[31410,142154],[31635,143242],[32864,142789],[32780,147247],[40126,143891],[40151,142560],[54895,133217],[54963,128659],[55926,128010],[68136,126922],[69588,122906],[69696,114223],[68805,114201]],[[309348,188969],[309322,186519],[303921,186385],[301365,182642],[294550,182518],[283233,162581],[282163,162547],[282077,172302],[269451,171935],[269388,174031],[265645,173918],[265620,177054],[271058,177222],[270952,188318],[274613,186771],[274672,181872],[278676,181660],[278695,179432],[280680,179504],[281628,181013],[281815,182104],[278334,182348],[278282,186889],[283763,187040],[283702,191926],[278221,191777],[278190,194223],[276360,194168],[276317,197836],[287285,198138],[288275,192051],[290095,192101],[290374,194804],[291460,193628],[292586,195478],[303380,194967],[304613,196149],[303756,193726],[307399,193824],[308204,192621],[307348,191373],[311090,190256],[311105,189032],[309348,188969]],[[314807,311537],[314885,307516],[307611,306631],[308155,284557],[304297,284388],[304557,270972],[300926,270825],[301168,256211],[297501,256058],[297559,251195],[292070,250989],[292002,255849],[290175,255788],[290108,260648],[264595,259840],[264286,280583],[289958,281462],[289760,291228],[293386,291357],[292732,324459],[294152,326250],[304931,329774],[306896,328911],[307086,321450],[311134,321443],[311026,333088],[312863,333596],[321583,329760],[322044,311520],[314807,311537]],[[279613,245701],[279554,230984],[275905,230880],[275936,228420],[272291,228213],[261726,201552],[261690,203699],[256253,203546],[256294,201087],[250815,200918],[250432,223096],[244993,222904],[244971,225346],[250411,225544],[250357,232889],[244367,232665],[244737,240019],[270440,240528],[270345,235593],[273295,235709],[274207,240628],[275861,240693],[275723,244343],[274878,244310],[276231,251668],[279254,251770],[279313,248124],[277491,248058],[277511,246842],[281160,246971],[281176,245755],[279613,245701]],[[320577,252010],[320460,244675],[318689,244618],[318722,242171],[315931,242081],[316047,232225],[303278,231815],[303389,221979],[308865,222143],[308921,217460],[316199,219936],[316339,207559],[310146,207344],[307344,202399],[307280,203975],[305460,203945],[305440,205579],[301779,205468],[301571,221903],[296098,221755],[296004,229138],[295092,229110],[295028,234011],[294115,233975],[293895,251053],[297559,251195],[297501,256058],[301168,256211],[300926,270825],[304557,270972],[304297,284388],[308155,284557],[308212,282107],[309313,282129],[315477,269166],[315664,261643],[323874,261610],[324001,251951],[320577,252010]],[[352709,197626],[345677,196195],[345832,183931],[338527,181740],[338515,183715],[342132,185375],[338486,186140],[338455,188580],[334804,188473],[334853,184826],[333018,184781],[333025,183564],[323899,183310],[323769,195535],[311022,195154],[310774,196371],[309177,193924],[309201,195096],[307382,195047],[307399,193824],[303756,193726],[304177,196775],[310146,207344],[314517,207476],[314536,205840],[316357,205889],[316374,204531],[321927,212601],[323555,215003],[323476,222560],[345346,223164],[345736,225961],[352740,224821],[352709,197626]],[[359989,140546],[359937,138447],[358356,138381],[356054,135557],[351821,135297],[351779,140175],[349944,140119],[348954,144968],[331638,143255],[331522,151245],[330196,151204],[330175,152480],[331501,152723],[331339,163989],[328463,163891],[328394,168788],[324019,168636],[323962,175914],[331221,179563],[331195,183519],[334853,184826],[334804,188473],[338455,188580],[338486,186140],[342121,186265],[342136,184766],[338515,183715],[338527,181740],[345832,183931],[345931,166937],[347698,166992],[347762,162097],[349581,162152],[349793,150225],[358004,149982],[358087,145354],[360821,145431],[360909,140573],[359989,140546]],[[357371,373521],[356993,372279],[355979,372296],[353910,359798],[350546,359381],[350677,355193],[341116,351749],[341148,350695],[332104,348569],[332050,350721],[329328,350731],[329311,336847],[336546,330715],[344499,330673],[339956,298165],[352369,296242],[366804,296091],[366833,294567],[374089,296048],[374165,281390],[356284,281597],[356987,275917],[355432,274319],[355452,271980],[356387,271962],[355846,265486],[359945,256841],[367444,263561],[367439,254104],[370889,253942],[370833,251810],[367429,251891],[367405,248187],[360308,244009],[358772,240633],[360153,242381],[363769,242300],[363719,236502],[357134,237108],[352748,227738],[352740,224821],[349649,225640],[352415,231592],[350876,232877],[354370,238070],[350865,239327],[343436,235475],[343120,236663],[345709,237322],[344804,238993],[345457,241734],[344219,242802],[344986,246238],[346803,245720],[348569,248541],[350417,246172],[352180,246847],[352803,262281],[324335,262847],[323717,281994],[329985,281905],[329736,291755],[326107,291791],[326055,293825],[329670,294236],[328503,306567],[330815,308465],[330768,311279],[330137,316393],[329235,316388],[329291,312772],[325679,311488],[325590,316427],[327422,316413],[327337,321372],[321854,321408],[321583,329760],[326615,328973],[327964,330200],[326869,333760],[328768,336740],[328302,355611],[312647,355626],[313498,367737],[306241,367715],[306065,378614],[307473,389569],[312292,390066],[313598,394838],[313831,397009],[309320,397007],[310311,401191],[314464,401195],[315389,406920],[320246,407092],[320247,409609],[322272,409602],[319732,414556],[348938,414768],[348980,413639],[355487,410363],[359573,405241],[357653,405201],[356578,395354],[360400,395349],[360522,388609],[364153,388589],[360535,387865],[360696,382512],[364369,382518],[364438,380588],[361149,369133],[358155,369184],[359434,366728],[358674,364835],[357747,365223],[357371,373521],[357699,374600],[359474,377242],[359007,378900],[357699,374600],[339039,308049],[338122,309910],[335942,309938],[336047,303697],[334570,302920],[333573,304861],[332406,304442],[332338,308457],[331365,308460],[331522,299264],[338540,298358],[337366,302974],[339289,303016],[339039,308049],[360871,408323],[356385,409933],[363598,410126],[363621,408418],[360871,408323],[353555,414851],[356236,414952],[356336,409982],[354033,411918],[353555,414851]],[[246675,119206],[246860,116016],[249586,118913],[251902,119060],[252043,109041],[256772,109220],[256945,107690],[266609,107989],[266670,103724],[259389,103516],[259694,98469],[257493,96706],[256764,94324],[248576,88524],[248774,86868],[251675,84992],[251818,77264],[248712,77190],[248593,84660],[247668,84634],[247890,75553],[247721,73387],[246897,73362],[246460,84373],[244837,84324],[244121,82491],[243761,77297],[243417,84684],[239527,84824],[239506,87574],[237350,91297],[228744,91066],[228660,95431],[233779,95515],[233566,108567],[237393,108662],[237307,116031],[235977,118920],[246675,119206]],[[272405,139095],[272507,137892],[276188,138023],[275268,135553],[275370,128266],[280823,128451],[280739,133291],[282168,133341],[283459,133373],[283548,128541],[288085,128697],[288460,108768],[287316,105525],[279125,104817],[278521,103174],[277844,104318],[276815,102543],[276176,103755],[273698,101638],[273018,102728],[269254,98107],[268869,95732],[265712,99933],[259694,98469],[259389,103516],[266670,103724],[266609,107989],[256945,107690],[256772,109220],[259300,109316],[259256,111890],[263068,112050],[263113,109444],[266608,109549],[266562,113430],[264689,113372],[264657,115794],[260649,116409],[261894,118136],[266465,118269],[266367,123110],[264024,123049],[263981,125877],[266321,125944],[267052,124356],[269182,128050],[273552,128205],[273481,133057],[271968,132176],[270528,133987],[271629,136010],[271080,138544],[272405,139095],[269091,95437],[270316,95556],[269438,94976],[269091,95437]],[[309258,129364],[308158,126906],[304528,126800],[304562,124380],[300908,124268],[300288,120578],[302549,116265],[295273,111953],[295179,110307],[297071,108838],[287981,105502],[288003,133548],[295285,133807],[295212,138659],[296118,139239],[295144,143500],[298773,144820],[298790,143601],[306087,143794],[306109,142243],[307935,142291],[308028,135665],[309825,137088],[309258,129364]],[[352772,237020],[350876,232877],[352415,231592],[349649,225640],[345736,225961],[345346,223164],[323476,222560],[323555,215003],[316374,204531],[316357,205889],[314536,205840],[314517,207476],[316339,207559],[316199,219936],[308921,217460],[308865,222143],[303389,221979],[303278,231815],[316047,232225],[315931,242081],[318722,242171],[318689,244618],[320460,244675],[320363,252003],[324001,251951],[323858,262852],[352803,262281],[352180,246847],[350417,246172],[348569,248541],[346803,245720],[344986,246238],[344219,242802],[345457,241734],[344804,238993],[345709,237322],[343122,236564],[343436,235475],[350865,239327],[354370,238070],[353572,236369],[352772,237020]],[[328066,139499],[328099,135978],[322645,134488],[322663,133142],[326976,133319],[327006,131121],[330708,131223],[330728,129819],[324537,129660],[325311,119108],[322372,115324],[320515,106833],[323725,105844],[317939,106230],[314813,112296],[314654,115207],[315937,115785],[316049,111869],[318215,110564],[317785,116088],[316818,117134],[304876,113475],[297660,107993],[298426,110760],[301199,112151],[303452,116708],[301675,116445],[300288,120578],[300908,124268],[304562,124380],[304528,126800],[308158,126906],[308135,128487],[309935,129383],[309825,137088],[317082,140792],[317094,139773],[324370,141037],[324324,144277],[329786,144415],[330800,139566],[331695,139590],[331770,134704],[329092,134633],[329016,139518],[328066,139499],[323872,105834],[323988,106807],[324139,105816],[323872,105834]],[[330532,144429],[324324,144277],[324370,141037],[317094,139773],[316920,140744],[308028,135665],[307935,142291],[306109,142243],[306087,143794],[302437,143696],[302374,148560],[300542,148458],[300366,163044],[294907,162749],[294904,167500],[298213,170117],[305453,171702],[309369,169393],[316657,169563],[323962,175914],[324019,168636],[328394,168788],[328463,163891],[331339,163989],[331501,152723],[330175,152480],[330196,151204],[331522,151245],[331619,144452],[330532,144429]],[[353675,131901],[351855,131847],[351871,130419],[350045,130363],[349656,129116],[343853,129146],[341170,125815],[341840,124190],[334904,125313],[333287,123442],[333257,120953],[328545,121045],[325311,119108],[324537,129660],[330728,129819],[330708,131223],[327006,131121],[326976,133319],[322663,133142],[322645,134488],[328099,135978],[328044,139514],[329016,139518],[329092,134633],[331770,134704],[331695,139590],[330800,139566],[329786,144415],[335179,143110],[348954,144968],[349944,140119],[351779,140175],[351821,135297],[350000,135244],[350013,133985],[353650,134124],[353675,131901]],[[376707,139040],[367473,135852],[362346,129900],[361063,132259],[353560,129366],[350040,129434],[351871,130419],[351855,131847],[353675,131901],[353650,134124],[350013,133985],[350000,135244],[356054,135557],[358356,138381],[359937,138447],[359906,140543],[360909,140573],[360821,145431],[358087,145354],[358004,149982],[359815,150034],[359554,154505],[367667,157891],[367727,165085],[374975,165012],[374833,147956],[378486,151894],[378395,139964],[376707,139040]],[[374741,165015],[367727,165085],[367667,157891],[359554,154505],[359815,150034],[349793,150225],[349581,162152],[347762,162097],[347698,166992],[345931,166937],[345677,196195],[352709,197626],[352835,184292],[374578,183852],[374741,165015]]];
window.wardPaths = _.map(simpleWardPaths,function(ward){
    return _.map(ward, function (point) {
        return convertPoint(point);
    });
});

// ANGULAR

var dateMapApp = angular.module('dateMapApp', []).value('$anchorScroll', angular.noop);

dateMapApp.config(function($routeProvider) {
    $routeProvider.
        when('/', {
            action: "yesterday"
        }).
        when('/:date/', {
            action: "date"
        }).
        when('/:date/:serviceSlug/', {
            action: "date.service"
        }).
        otherwise({
            redirectTo: '/'
        });
});

dateMapApp.factory('Data', function () {
    var data = {
    };

    if (!window.chicagoMap) {
        window.chicagoMap = L.map('map',{scrollWheelZoom: false}).setView([41.83, -87.81], 11);

        L.tileLayer('http://{s}.tile.cloudmade.com/{key}/{styleId}/256/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
            key: '302C8A713FF3456987B21FAAE639A13B',
            maxZoom: 11,
            styleId: 82946
        }).addTo(window.chicagoMap);
        window.chicagoMap.zoomControl.setPosition('bottomright');
    }

    data.setDate = function(date) {
        data.date = date.format(dateFormat);
        data.dateFormatted = date.format('MMM D, YYYY');
        data.prevDay = moment(date).subtract('day',1);
        data.nextDay = moment(date).add('day',1);
        data.prevDayFormatted = data.prevDay.format('MMM D');
        data.nextDayFormatted = data.nextDay.format('MMM D');
        data.isLatest = data.nextDay.isAfter(window.yesterday);
    };

    return data;
});

dateMapApp.controller("dateCtrl", function ($scope, Data, $http, $location, $route, $routeParams, $timeout) {
    var wardColors = [
        '#182A35',
        '#244153',
        '#315971',
        '#3C7090',
        '#4888AF',
        '#629CBF'
    ].reverse();

    var urlSuffix = function() {
        return Data.serviceObj.slug ? Data.serviceObj.slug + '/' : '';
    };

    $scope.goToPrevDay = function() {
        if (Data.prevDay.isBefore(window.earliestDate)) {
            return false;
        }
        $location.path(Data.prevDay.format(dateFormat) + '/' + urlSuffix());
    };

    $scope.goToNextDay = function() {
        if (Data.isLatest) {
            return false;
        }
        $location.path(Data.nextDay.format(dateFormat) + '/' + urlSuffix());
    };

    $scope.serviceClass = function(service) {
        var classes = [];
        if (service.Slug == Data.serviceObj.slug) {
            classes.push('active');
            if (service.Slug == $routeParams.serviceSlug) {
                classes.push('in-url');
            }
        }
        if (service.Slug == Data.maxService.Slug) {
            classes.push('max');
        }
        if (service.Count > service.Average) {
            classes.push('up');
        } else if (service.Count < service.Average) {
            classes.push('down');
        }
        return classes.join(" ");
    };

    var renderMap = function() {
        var serviceObj = _.find(Data.serviceList, function(obj) {
            return obj.Slug == Data.serviceObj.slug;
        });

        var allCounts = _.toArray(serviceObj.Wards);
        var maxCount = _.max(allCounts);
        var hasRanges = maxCount >= wardColors.length;

        var grades = _.range(0, Math.min(wardColors.length, maxCount + 1));
        if (hasRanges) {
            grades = _.map(grades, function (grade) {
                return Math.round(grade * maxCount / (grades.length - 1));
            });
        }

        var allColors = _.map(allCounts, function(count) {
            // Shift the count to be between grades, find the index (which'll never be 0), then move it back one slot.
            var pos = _.sortedIndex(grades, count + 0.1) - 1;
            return wardColors[pos];
        });

        if (window.allWards) {
            window.allWards.clearLayers();
        } else {
            window.allWards = L.layerGroup();
        }

        var wardClick = function(e) {
            document.location = 'ward/' + e.target.options.id + '/#' + $location.path();
        };

        var pluralize = function(n) {
            return n == 1 ? '' : 's';
        };

        $timeout(function() {
            for (var path in wardPaths) {
                var wardNum = parseInt(path,10) + 1;
                var wardCount = serviceObj.Wards[wardNum];
                var poly = L.polygon(
                    wardPaths[path],
                    {
                        id: wardNum,
                        opacity: 1,
                        weight: 1,
                        dashArray: '3',
                        color: 'white',
                        fillOpacity: 0.8,
                        fillColor: allColors[wardNum-1]
                    }
                )
                .bindLabel('<h4>Ward ' + wardNum + '</h4>' + wardCount + ' request' + pluralize(wardCount))
                .on('click', wardClick);
                window.allWards.addLayer(poly);
            }

            if (window.legend) {
                window.legend.removeFrom(window.chicagoMap);
            }
            window.legend = L.control({position: 'topright'});

            window.legend.onAdd = function(map) {
                var div = L.DomUtil.create('div', 'legend');
                var labels = _.map(grades, function (grade, i) {
                    return '<i style="background:' + wardColors[i] + '"></i> <b>' + grade + (hasRanges && grade < _.last(grades) ? '+': '') + "</b> request" + (grade == 1 && !hasRanges ? '' : 's');
                });

                div.innerHTML = labels.join('<br>');
                return div;
            };

            window.allWards.addTo(window.chicagoMap);
            legend.addTo(window.chicagoMap);
        });
    };

    var changeDate = function() {
        var countsURL = window.apiDomain + 'requests/counts_by_day.json?day=' + Data.date + '&callback=JSON_CALLBACK';

        $http.jsonp(countsURL).
            success(function(response, status, headers, config) {
                Data.reponse = response;

                var serviceCollection = _.map(_.pairs(response), function(pair) {
                    service = _.find(serviceTypesJSON, function(obj) { return obj.code == pair[0]; });
                    return _.extend(pair[1], {
                        "Code": pair[0],
                        "Slug": service.slug,
                        "Name": service.name,
                        "AvgRounded": Math.round(pair[1].Average * 10) / 10,
                        "Percent": Math.min(Math.round((pair[1].Count - pair[1].Average) * 100 / pair[1].Average), 100)
                    });
                });

                Data.serviceList = _.sortBy(serviceCollection, function(obj) {
                    return obj.Slug;
                });

                Data.maxService = _.max(Data.serviceList, function(obj) { return obj.Percent; });
                if (_.isEmpty(Data.serviceObj)) {
                    Data.serviceObj = lookupSlug(Data.maxService.Slug);
                }

                renderMap();
            }
        );
    };

    $scope.data = Data;

    $scope.$on(
        "$routeChangeSuccess",
        function ($e, $currentRoute, $previousRoute) {
            Data.setDate(parseDate($routeParams.date, window.yesterday, $location));
            Data.serviceObj = {};
            Data.action = $route.current.action;
            if ($currentRoute.pathParams.serviceSlug) {
                if (Data.action == 'date.service') {
                    Data.serviceObj = window.lookupSlug($currentRoute.pathParams.serviceSlug);
                }
            }
            Data.currURL = "#/" + Data.date + "/" + urlSuffix();

            if (!$previousRoute) {
                changeDate();
            } else if ($currentRoute.pathParams.date != $previousRoute.pathParams.date) {
                changeDate();
            } else if ($currentRoute.pathParams.serviceSlug != $previousRoute.pathParams.serviceSlug) {
                renderMap();
            } else {
                changeDate();
            }
        }
    );
});
